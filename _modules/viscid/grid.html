<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>viscid.grid &mdash; Viscid 0.50.2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.50.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Viscid 0.50.2 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Viscid 0.50.2 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for viscid.grid</h1><pre>
#!/usr/bin/env python
# i guess this is the 'new' one???

from __future__ import print_function

from . import field
from .bucket import Bucket
from .vutil import tree_prefix

<div class="viewcode-block" id="Grid"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid">[docs]</a>class Grid(object):
    """ Grids contain fields... Datasets recurse to grids using __getitem__
    and get_field in order to find fields

    The following attributes are for customizing data reads, intended to
    be changed by `grid.Grid.flag = value`:
    force_vector_layout = field.LAYOUT_*, force all vectors to be of a certain
                          layout when they're created (default: LAYOUT_DEFAULT)
    """
    topology_info = None
    geometry_info = None
    crds = None
    fields = None
    # so... not all grids have times? if we try to access time on a grid
    # that doesnt have one, there is probably a bug somewhere
    # time = None

    name = None

    # these attributes are intended to control how fields are read
    # they can be customized by setting the class value, and inherited
    # by grids that get created in the future
    force_vector_layout = field.LAYOUT_DEFAULT

    def __init__(self, name=None, **kwargs):
        """ all kwargs are added to the grid as attributes """
        self.name = name
        self.fields = Bucket()

        self.crds = None  # Coordinates()
        for opt, value in kwargs.items():
            setattr(self, opt, value)

    @staticmethod
<div class="viewcode-block" id="Grid.null_transform"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.null_transform">[docs]</a>    def null_transform(something):
        return something

    # def set_time(self, time):
    #     self.time = time
</div>
<div class="viewcode-block" id="Grid.set_crds"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.set_crds">[docs]</a>    def set_crds(self, crds_object):
        self.crds = crds_object
</div>
<div class="viewcode-block" id="Grid.add_field"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.add_field">[docs]</a>    def add_field(self, *fields):
        """ Note: in XDMF reader, the grid will NOT have crds when adding
        fields, so any grid crd transforms won't be set """
        for f in fields:
            if isinstance(f, field.VectorField):
                f.layout = self.force_vector_layout
            self.fields[f.name] = f
</div>
<div class="viewcode-block" id="Grid.unload"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.unload">[docs]</a>    def unload(self):
        """ unload is meant to give children a chance to free caches, the idea
        being that an unload will free memory, but all the functionality is
        preserved, so data is accessable without an explicit reload """
        for fld in self.fields:
            fld.unload()
        # TODO: does anything else need to be unloaded in here?
</div>
<div class="viewcode-block" id="Grid.nr_times"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.nr_times">[docs]</a>    def nr_times(self, *args, **kwargs): #pylint: disable=W0613,R0201
        return 1
</div>
<div class="viewcode-block" id="Grid.iter_times"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.iter_times">[docs]</a>    def iter_times(self, *args, **kwargs): #pylint: disable=W0613
        # FIXME: it is unclear to me what to do here, since a dataset
        # may have &gt; 1 grid... and if so only the first will be returned...
        # i guess there is some ambiguity if there is no temporal dataset...
        with self as me:
            yield me
</div>
<div class="viewcode-block" id="Grid.iter_fields"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.iter_fields">[docs]</a>    def iter_fields(self, named=None, **kwargs): #pylint: disable=W0613
        """ iterate over fields in a grid, if named is given, it should be a
        list of field names to iterate over """
        if named is not None:
            for name in named:
                with self.fields[name] as f:
                    yield f
        else:
            for fld in self.fields:
                with fld as f:
                    yield f
</div>
<div class="viewcode-block" id="Grid.print_tree"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.print_tree">[docs]</a>    def print_tree(self, recursive=False, prefix=""): #pylint: disable=W0613
        self.fields.print_tree(prefix=prefix + tree_prefix)

    ##################################
    ## Utility methods to get at crds
    # these are the same as something like self.crds['xnc']
    # or self.crds.get_crd()</div>
<div class="viewcode-block" id="Grid.get_crd_nc"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.get_crd_nc">[docs]</a>    def get_crd_nc(self, axis, shaped=False):
        """ returns a flat ndarray of coordinates along a given axis
        axis can be crd name as string, or index, as in x==2, y==1, z==2 """
        return self.crds.get_nc(axis, shaped=shaped)
</div>
<div class="viewcode-block" id="Grid.get_crd_cc"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.get_crd_cc">[docs]</a>    def get_crd_cc(self, axis, shaped=False):
        """ returns a flat ndarray of coordinates along a given axis
        axis can be crd name as string, or index, as in x==2, y==1, z==2 """
        return self.crds.get_cc(axis, shaped=shaped)
</div>
<div class="viewcode-block" id="Grid.get_crd_ec"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.get_crd_ec">[docs]</a>    def get_crd_ec(self, axis, shaped=False):
        """ returns a flat ndarray of coordinates along a given axis
        axis can be crd name as string, or index, as in x==2, y==1, z==2 """
        return self.crds.get_ec(axis, shaped=shaped)
</div>
<div class="viewcode-block" id="Grid.get_crd_fc"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.get_crd_fc">[docs]</a>    def get_crd_fc(self, axis, shaped=False):
        """ returns a flat ndarray of coordinates along a given axis
        axis can be crd name as string, or index, as in x==2, y==1, z==2 """
        return self.crds.get_fc(axis, shaped=shaped)

    ## these return all crd dimensions
    # these are the same as something like self.crds.get_crds()</div>
<div class="viewcode-block" id="Grid.get_crds_nc"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.get_crds_nc">[docs]</a>    def get_crds_nc(self, axes=None, shaped=False):
        """ returns all node centered coords as a list of ndarrays, flat if
        shaped==False, or shaped if shaped==True """
        return self.crds.get_crds_nc(axes=axes, shaped=shaped)
</div>
<div class="viewcode-block" id="Grid.get_crds_cc"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.get_crds_cc">[docs]</a>    def get_crds_cc(self, axes=None, shaped=False):
        """ returns all cell centered coords as a list of ndarrays, flat if
        shaped==False, or shaped if shaped==True """
        return self.crds.get_crds_cc(axes=axes, shaped=shaped)
</div>
<div class="viewcode-block" id="Grid.get_crds_fc"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.get_crds_fc">[docs]</a>    def get_crds_fc(self, axes=None, shaped=False):
        """ returns all face centered coords as a list of ndarrays, flat if
        shaped==False, or shaped if shaped==True """
        return self.crds.get_crds_fc(axes=axes, shaped=shaped)
</div>
<div class="viewcode-block" id="Grid.get_crds_ec"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.get_crds_ec">[docs]</a>    def get_crds_ec(self, axes=None, shaped=False):
        """ returns all edge centered coords as a list of ndarrays, flat if
        shaped==False, or shaped if shaped==True """
        return self.crds.get_crds_ec(axes=axes, shaped=shaped)

    ##</div>
<div class="viewcode-block" id="Grid.get_field"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.get_field">[docs]</a>    def get_field(self, fldname, time=None): #pylint: disable=W0613
        try:
            return self.fields[fldname]
        except KeyError:
            func = "_get_" + fldname
            if hasattr(self, func):
                return getattr(self, func)()
            else:
                raise KeyError("field not found")
</div>
<div class="viewcode-block" id="Grid.get_grid"><a class="viewcode-back" href="../../viscid.html#viscid.grid.Grid.get_grid">[docs]</a>    def get_grid(self, time=None): #pylint: disable=W0613
        return self
</div>
    def __contains__(self, item):
        return item in self.fields

    def __len__(self):
        return len(self.fields)

    def __getitem__(self, item):
        """ returns a field by name, or if no field is found, a coordinate by
        name some crd identifier, see Coordinate.get_item for details """
        try:
            return self.get_field(item)
        except KeyError:
            if self.crds is not None and item in self.crds:
                return self.crds[item]
            else:
                raise KeyError(item)

    def __setitem__(self, fldname, fld):
        self.fields[fldname] = fld

    def __delitem__(self, fldname):
        self.fields.__delitem__(fldname)

    def __str__(self):
        return "&lt;Grid name={0}&gt;".format(self.name)

    def __enter__(self):
        return self

    def __exit__(self, typ, value, traceback):
        self.unload()
        return None

##
## EOF
##</div>
</pre>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Viscid 0.50.2 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Kristofor Maynard.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>