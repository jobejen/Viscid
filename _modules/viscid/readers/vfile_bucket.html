

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>viscid.readers.vfile_bucket &mdash; Viscid 0.60.0 dev documentation</title>
  

  
  

  
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../../../',
        VERSION:'0.60.0 dev',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="Viscid 0.60.0 dev documentation" href="../../../index.html"/>
        <link rel="up" title="viscid.readers" href="../readers.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../../index.html" class="icon icon-home"> Viscid</a>
        <form class="wy-form" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#standard-setup">Standard Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#for-developers">For Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../philosophy.html">Philosophy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../philosophy.html#data-abstraction">Data Abstraction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ex_reader.html">Reading/Plotting Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../ex_reader.html#super-simple">Super Simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ex_reader.html#two-plots-one-figure">Two Plots, One Figure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ex_reader.html#playing-with-time">Playing with Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ex_reader.html#slicing-fields">Slicing Fields</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ex_openggcm.html">OpenGGCM Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../ex_openggcm.html#gse-coordinates">GSE coordinates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ex_openggcm.html#ionosphere-files">Ionosphere Files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ex_calc.html">Calculator Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../ex_calc.html#streamlines">Streamlines</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../command_line.html">Command Line Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../command_line.html#p2d">p2d</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../command_line.html#viscid-diff">viscid_diff</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../command_line.html#bitmaskbits">bitmaskbits</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../viscid.html">viscid package</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">Viscid</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="../../../index.html">Docs</a> &raquo;</li>
  <li><a href="">viscid.readers.vfile_bucket</a></li>
  
</ul>
<hr/>

          
  <h1>Source code for viscid.readers.vfile_bucket</h1><pre>
#!/usr/bin/env python

from __future__ import print_function
import os
from glob import glob
import logging
import six
# import sys
try:
    from collections import OrderedDict
except ImportError:
    from viscid.compat import OrderedDict

from viscid.bucket import Bucket
from viscid.readers.vfile import VFile


<div class="viewcode-block" id="VFileBucket"><a class="viewcode-back" href="../../../viscid.readers.html#viscid.readers.vfile_bucket.VFileBucket">[docs]</a>class VFileBucket(Bucket):
    """ manages open files, create / get with get_file_bucket() as you
    generally only need one instance, but you can construct directly
    if you need more than one manager
    """

    def __init__(self, **kwargs):
        super(VFileBucket, self).__init__(ordered=True, **kwargs)

    # This routine is just sort of confusing
    # def add(self, fname, file):
    #     absfname = os.path.abspath(fname)
    #     self[(absfname, fname)] = f

<div class="viewcode-block" id="VFileBucket.load_file"><a class="viewcode-back" href="../../../viscid.readers.html#viscid.readers.vfile_bucket.VFileBucket.load_file">[docs]</a>    def load_file(self, fname, index_handle=True, **kwargs):
        """ load a single file and return a vFile instance, not a list
        of vFiles like load does
        """
        fls = self.load_files([fname], index_handle=index_handle, **kwargs)
        if len(fls) == 0:
            logging.warn("No files loaded for '{0}', is the path "
                         "correct?".format(fname))
            return None
        else:
            if len(fls) &gt; 1:
                logging.warn("Loaded &gt; 1 file for '{0}', did you mean to call "
                             "load_files()?".format(fname))
            return fls[0]
</div>
<div class="viewcode-block" id="VFileBucket.load_files"><a class="viewcode-back" href="../../../viscid.readers.html#viscid.readers.vfile_bucket.VFileBucket.load_files">[docs]</a>    def load_files(self, fnames, index_handle=True, file_type=None, **kwargs):
        """Load files, and add them to the bucket

        Initialize obj before it's put into the list, whatever is returned
        is what gets stored, returning None means object init failed, do
        not add to the _objs list

        Parameters:
            fnames: a list of file names (can cantain glob patterns)
            index_handle: ??
            file_type: a class that is a subclass of VFile, if given,
                use this file type, don't use the autodetect mechanism
            kwargs: passed to file constructor

        Returns:
            A list of VFile instances. The length may not be the same
            as the length of fnames, and the order may not be the same
            in order to accomidate globs and file grouping.
        """
        if not isinstance(fnames, (list, tuple)):
            fnames = [fnames]
        file_lst = []

        # glob and convert to absolute paths
        globbed_fnames = []
        for fname in fnames:
            better_fname = os.path.expanduser(os.path.expandvars(fname))
            absfnames = [os.path.abspath(fn) for fn in glob(better_fname)]
            globbed_fnames += absfnames
        fnames = globbed_fnames

        # detect file types
        types_detected = OrderedDict()
        for i, fname in enumerate(fnames):
            if file_type is None:
                file_type = VFile.detect_type(fname)
            if not file_type:
                raise RuntimeError("Can't determine type "
                                   "for {0}".format(fname))
            value = (fname, i)
            try:
                types_detected[file_type].append(value)
            except KeyError:
                types_detected[file_type] = [value]

        # see if the file's already been loaded, or load it, and add it
        # to the bucket and all that good stuff
        file_lst = []
        for ftype, vals in types_detected.items():
            names = [v[0] for v in vals]
            # group all file names of a given type
            try:
                groups = ftype.group_fnames(names)
            except AttributeError:
                # can't group fnames for this type, that's ok
                groups = names

            # iterate all the groups and add them
            for group in groups:
                f = None
                if isinstance(group, list):
                    # FIXME: if the glob has changed since it was loaded,
                    # this won't know that it has changed... I'm not sure
                    # if there's a good way to figure this out... the user
                    # can always just unload / reload
                    g0 = group[0]
                else:
                    g0 = group

                if g0 in self:
                    f = self[g0]
                else:
                    try:
                        f = ftype(group, vfilebucket=self, **kwargs)
                    except IOError as e:
                        s = " IOError on file: {0}\n".format(group)
                        s += "              File Type: {0}\n".format(file_type)
                        s += "              {0}".format(e.message)
                        logging.warn(s)
                    except ValueError:
                        # what's this about?
                        pass

                try:
                    handle_name = f.collective_name(group)
                except AttributeError:
                    handle_name = VFile.collective_name(group)
                self.set_item([handle_name], f, index_handle=index_handle)
                file_lst.append(f)

        return file_lst
</div>
<div class="viewcode-block" id="VFileBucket.remove_item"><a class="viewcode-back" href="../../../viscid.readers.html#viscid.readers.vfile_bucket.VFileBucket.remove_item">[docs]</a>    def remove_item(self, item):
        item.unload()
        super(VFileBucket, self).remove_item(item)
</div>
<div class="viewcode-block" id="VFileBucket.remove_all_items"><a class="viewcode-back" href="../../../viscid.readers.html#viscid.readers.vfile_bucket.VFileBucket.remove_all_items">[docs]</a>    def remove_all_items(self):
        for item in self._items.keys():
            item.unload()
        super(VFileBucket, self).remove_all_items()
</div>
    def __getitem__(self, handle):
        if isinstance(handle, six.string_types):
            handle = os.path.expanduser(os.path.expandvars(handle))
        return super(VFileBucket, self).__getitem__(handle)

    def __contains__(self, handle):
        if isinstance(handle, six.string_types):
            handle = os.path.expanduser(os.path.expandvars(handle))
        return super(VFileBucket, self).__contains__(handle)</div>
</pre>

          <footer>
  <hr/>

  <p>
      &copy; Copyright 2013, Kristofor Maynard.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://www.readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>